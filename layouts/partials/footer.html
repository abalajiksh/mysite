<div class="footer">
    {{ if .PrevInSection }}
	    {{ if .Site.Params.brand.footerPrev }}
            <a class="previous-post" href="{{ .PrevInSection.Permalink }}?ref=footer"><span style="font-weight:bold;">« {{ .Site.Params.brand.footerPrev }}</span><br>{{ .PrevInSection.Title }}</a>
        {{ end }}
	{{ end }}
    {{ if .NextInSection }}
	    {{ if .Site.Params.brand.footerNext }}
            <a class="next-post" href="{{ .NextInSection.Permalink }}?ref=footer"><span style="font-weight:bold;">{{ .Site.Params.brand.footerNext }} »</span><br>{{ .NextInSection.Title }}</a>
        {{ end }}
	{{ end }}
</div>

<script>
    themeFromLS = localStorage.getItem("theme")
    themeFromHugo = document.body.classList.contains("dark-theme") ? "dark" : "light"
    currentTheme = themeFromLS ? themeFromLS : themeFromHugo;

    var remark_config = {
        host: "https://comment.ashwinbalaji.xyz",
        site_id: "ashwinbalaji",
        theme: currentTheme,
        max_shown_comments: 100,
    }
</script>

<script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script>

<script>
console.log('Copy button script starting...');

// 󰅙 Disable Poison's copy button functionality
(function() {
  'use strict';
  
  function removePoisonButtons() {
    const poisonButtons = document.querySelectorAll('.copy-button:not(.code-wrapper .copy-code-button), .copy-success');
    console.log('Removing Poison buttons:', poisonButtons.length);
    poisonButtons.forEach(function(btn) {
      btn.remove();
    });
  }
  
  removePoisonButtons();
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', removePoisonButtons);
  }
  setTimeout(removePoisonButtons, 100);
})();

// 󰅩 Copy button functionality
(function() {
  'use strict';
  
  function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.width = "2em";
    textArea.style.height = "2em";
    textArea.style.padding = "0";
    textArea.style.border = "none";
    textArea.style.outline = "none";
    textArea.style.boxShadow = "none";
    textArea.style.background = "transparent";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    let success = false;
    try {
      success = document.execCommand('copy');
      console.log('Fallback copy result:', success);
    } catch (err) {
      console.error('Fallback copy failed:', err);
    }
    
    document.body.removeChild(textArea);
    return success;
  }
  
  function copyToClipboard(text) {
    console.log('Attempting to copy, text length:', text.length);
    if (!navigator.clipboard) {
      console.log('Using fallback method');
      return Promise.resolve(fallbackCopyTextToClipboard(text));
    }
    console.log('Using navigator.clipboard');
    return navigator.clipboard.writeText(text).then(
      function() { 
        console.log('Clipboard API success');
        return true; 
      },
      function(err) { 
        console.log('Clipboard API failed, using fallback:', err);
        return fallbackCopyTextToClipboard(text); 
      }
    );
  }
  
  function initCopyButtons() {
    const copyButtons = document.querySelectorAll('.code-wrapper .copy-code-button');
    console.log('Found copy buttons:', copyButtons.length);
    
    if (copyButtons.length === 0) {
      console.error('No copy buttons found! Check if render hook is working.');
    }
    
    copyButtons.forEach(function(button, index) {
      console.log('Attaching listener to button', index);
      button.addEventListener('click', function() {
        console.log('Button clicked!', index);
        const wrapper = button.closest('.code-wrapper');
        console.log('Found wrapper:', !!wrapper);
        
        if (!wrapper) {
          console.error('No wrapper found');
          return;
        }
        
        const codeElement = wrapper.querySelector('code');
        console.log('Found code element:', !!codeElement);
        
        if (codeElement) {
          const codeText = codeElement.innerText;
          console.log('Code text length:', codeText.length);
          
          const copyText = button.querySelector('.copy-text');
          const copyIcon = button.querySelector('.copy-icon');
          
          copyToClipboard(codeText).then(function(success) {
            console.log('Copy result:', success);
            if (success) {
              copyIcon.textContent = '󰄬';
              copyText.textContent = 'Copied!';
              
              setTimeout(function() {
                copyIcon.textContent = '󰆒';
                copyText.textContent = 'Copy';
              }, 2000);
            } else {
              copyIcon.textContent = '󰅙';
              copyText.textContent = 'Failed';
              
              setTimeout(function() {
                copyIcon.textContent = '󰆒';
                copyText.textContent = 'Copy';
              }, 2000);
            }
          });
        }
      });
    });
  }
  
  if (document.readyState === 'loading') {
    console.log('Waiting for DOMContentLoaded');
    document.addEventListener('DOMContentLoaded', initCopyButtons);
  } else {
    console.log('DOM already loaded, initializing immediately');
    initCopyButtons();
  }
})();
</script>
